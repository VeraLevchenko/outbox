# Настройка авторизации

## Создание пользователей

### Шаг 1: Создать файл users.json

Запустите скрипт для создания пользователей:

```bash
cd backend
python create_users.py
```

Этот скрипт создаст файл `users.json` с тремя пользователями:

| Логин       | Имя              | Роль     | Пароль   |
|-------------|------------------|----------|----------|
| levchenko   | Левченко В.С.    | director | логин123 |
| gabidulina  | Габидулина Р.Р.  | head     | логин123 |
| gorskaya    | Горская Т.К.     | head     | логин123 |

### Шаг 2: Проверить что файл создан

```bash
ls -la users.json
cat users.json
```

Вы должны увидеть JSON файл с захешированными паролями.

---

## Тестирование авторизации

### 1. Запустить backend сервер

```bash
cd backend
source ../venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. Тест через Swagger UI

Откройте: **http://localhost:8000/docs**

Найдите секцию **"auth"**:

#### Тест логина:

1. Нажмите на `POST /api/auth/login`
2. Нажмите "Try it out"
3. Введите:
   ```json
   {
     "username": "levchenko",
     "password": "логин123"
   }
   ```
4. Нажмите "Execute"
5. Вы получите `access_token`

#### Тест получения информации о пользователе:

1. Скопируйте `access_token` из предыдущего ответа
2. Нажмите на `GET /api/auth/me`
3. Нажмите "Try it out"
4. Нажмите кнопку "Authorize" (замок) вверху страницы
5. Вставьте токен в поле `Value`
6. Нажмите "Authorize" и закройте окно
7. Вернитесь к `GET /api/auth/me` и нажмите "Execute"
8. Вы увидите информацию о пользователе

### 3. Тест через curl

```bash
# Логин
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"levchenko","password":"логин123"}'

# Сохраните полученный access_token и используйте в следующем запросе:
TOKEN="ваш_токен_здесь"

# Получить информацию о пользователе
curl http://localhost:8000/api/auth/me \
  -H "Authorization: Bearer $TOKEN"
```

---

## Роли пользователей

### Director (Руководитель)
- **Пользователь:** Левченко В.С.
- **Логин:** levchenko
- **Колонка Kaiten:** "На подпись"
- **Права:**
  - Выбор исполнителя
  - Регистрация и подпись документов
  - Возврат на доработку
  - Пропуск карточки

### Head (Начальник отдела)
- **Пользователи:** Габидулина Р.Р., Горская Т.К.
- **Логины:** gabidulina, gorskaya
- **Колонка Kaiten:** "Проект готов. Согласование начальника отдела"
- **Права:**
  - Подпись документов
  - Возврат на доработку

---

## Добавление новых пользователей

Отредактируйте `backend/create_users.py` и добавьте нового пользователя в список `users_data["users"]`:

```python
{
    "username": "новый_логин",
    "password_hash": password_hash,  # Используется тот же хеш
    "role": "head",  # или "director"
    "full_name": "Фамилия И.О."
}
```

Затем запустите скрипт заново:

```bash
python create_users.py
```

---

## Изменение пароля

Если нужно изменить пароль для всех пользователей:

1. Отредактируйте `create_users.py`
2. Измените строку: `PASSWORD = "новый_пароль"`
3. Запустите: `python create_users.py`

Если нужно разные пароли для разных пользователей, измените скрипт, создавая отдельные хеши для каждого пользователя.

---

## Безопасность

⚠️ **Важно для продакшена:**

1. **Изменить SECRET_KEY** в `.env` файле на случайную строку
2. **Изменить пароли** с "логин123" на более сложные
3. **Не коммитить** файл `users.json` в Git (добавлен в .gitignore)
4. **Использовать HTTPS** для передачи токенов

---

## Структура users.json

```json
{
  "users": [
    {
      "username": "levchenko",
      "password_hash": "$2b$12$...",
      "role": "director",
      "full_name": "Левченко В.С."
    }
  ]
}
```

Поля:
- `username` - логин для входа
- `password_hash` - bcrypt хеш пароля (НЕ сам пароль!)
- `role` - роль ("director" или "head")
- `full_name` - полное имя для отображения
